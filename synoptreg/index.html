<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Synoptic Climate Classification and Spatial Regionalization of Environmental Data • synoptReg</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Synoptic Climate Classification and Spatial Regionalization of Environmental Data">
<meta property="og:description" content="Set of functions to compute different types of synoptic classification methods and for analysing their effect on environmental variables. More information about the methods used in Lemus-Canovas et al. 2019 &lt;10.1016/j.atmosres.2019.01.018&gt; and Martin-Vide et al. 2008 &lt;10.5194/asr-2-99-2008&gt;.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">synoptReg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="synoptreg-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#synoptreg-" class="anchor"></a>synoptReg <img src="img/logo.png" align="right" alt="" width="140">
</h1></div>
</div>
<div id="synoptreg-synoptic-climate-classification-and-spatial-regionalization-of-environmental-data" class="section level1">
<h1 class="hasAnchor">
<a href="#synoptreg-synoptic-climate-classification-and-spatial-regionalization-of-environmental-data" class="anchor"></a><code>synoptReg</code>: Synoptic Climate Classification and Spatial Regionalization of Environmental Data</h1>

<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p><strong>synoptReg</strong> is an open source package for computing synoptic climate classifications and spatial regionalizations of environmental data.</p>
<hr>
<p>Contents:</p>
<ul>
<li><a href="#why-this-package">Why this package</a></li>
<li>
<a href="#how-it-works">How it works</a>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#functions-provided">Functions provided</a></li>
<li><a href="#usage">Usage</a></li>
</ul>
</li>
<li><a href="#citation">Citation</a></li>
<li><a href="#contact">Contact</a></li>
</ul>
<hr>
</div>
<div id="why-this-package" class="section level2">
<h2 class="hasAnchor">
<a href="#why-this-package" class="anchor"></a>Why this package</h2>
<p>The interaction between the troposphere and the environment is well known, and how this can condition human activities on some occasions. These situations can occur with an anticyclonic block that causes an increase in the concentration of NO<sub>2</sub>; or when a low-pressure area causes abundant rainfall over urban areas, etc. This package is intended to be a roadmap for territorial management on a regional scale and to anticipate the management of adverse situations for the population, due to pollution, as well as extreme weather conditions. In short, <code>synoptReg</code> allows to:</p>
<ul>
<li>Compute an objective <strong>synoptic classification</strong> to obtain the main atmospheric patterns, the so-called weather types, of a given region.</li>
<li>Represent the <strong>impact of each weather type</strong> on an environmental variable (continuous): precipitation, temperature, pollutants, …</li>
<li>Define a <strong>categorical regionalization</strong> of this environmental variable. Each region will be independent and with specific characteristics.</li>
</ul>
</div>
<div id="how-it-works" class="section level2">
<h2 class="hasAnchor">
<a href="#how-it-works" class="anchor"></a>How it works</h2>
<div id="installation" class="section level3">
<h3 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># To install the CRAN version (0.2.1):</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"synoptReg"</span>)</a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co"># To install the latest version (0.3.0) from Github:</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co"># install.packages("devtools")</span></a>
<a class="sourceLine" id="cb1-6" title="6">devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">"lemuscanovas/synoptReg"</span>)</a></code></pre></div>
</div>
<div id="functions-provided" class="section level3">
<h3 class="hasAnchor">
<a href="#functions-provided" class="anchor"></a>Functions provided</h3>
<p>synoptReg has two functions related to download, read and format data:</p>
<ul>
<li>
<code>download_ncep</code> allows the user to download NCEP/NCAR data.(<strong>only available using the developement version</strong>)</li>
<li>
<code>read_nc</code> reads a NetCDF file to extract the atmospheric or environmental variable, longitudes, latitudes and dates. A continuous NetCDF without date gaps is required.</li>
<li>
<code>tidy_cuttime_nc</code> formats the 3D-array output from <code>read_nc</code> function to an S-mode dataframe (variables = grid points, observations = days). Optionally, you can set the time period between specific years and/or decide if you want work with the full year or only with 3 - month season.</li>
</ul>
<p>synoptReg also has two functions to perform the PCA approach to compute the synoptic classification:</p>
<ul>
<li>
<code>pca_decision</code> plots the explained variance against the number of the principal component. In addition, it returns all the information about the PCA performance.</li>
<li>
<code>synoptclas</code> establishes a synoptic classification based on any atmospheric variable (i.e. mean sea level pressure, geoptential height at 500 hPa, etc).</li>
<li>
<code>classjen</code> computes the Jenkinson and Collison objective classification (Lamb based). <span style="color:red"><em>Under developement</em></span>.</li>
</ul>
<p>There are two functions to rasterize the results in order to get a nice visualization of the aftermentioned synoptic classification:</p>
<ul>
<li>
<code>raster_clas</code> converts the dataframe of the synoptic classification data into a RasterStack format.</li>
<li>
<code>raster_ct2env</code> converts the dataframe of the environmental data based on the synoptic classification into a RasterStack object.</li>
</ul>
<p>Finally, synoptReg provides three functions to convert our data to raster, perform a raster PCA and finally, execute an automatic spatial regionalisation (clustering):</p>
<ul>
<li>
<code>raster_pca</code> performs a PCA on a RasterStack object.</li>
<li>
<code>regionalization</code> Performs an unspervised clustering of the RasterStack object.</li>
</ul>
</div>
<div id="usage" class="section level3">
<h3 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h3>
<p>First of all, we can download the synoptic data, in this case, we download the sea level pressure varible using the <code>download_ncep</code> function:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(synoptReg)</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3">slp &lt;-<span class="st"> </span><span class="kw"><a href="reference/download_ncep.html">download_ncep</a></span>(<span class="dt">var =</span> <span class="st">"slp"</span>, </a>
<a class="sourceLine" id="cb2-4" title="4">                     <span class="dt">level =</span> <span class="st">"surface"</span>,</a>
<a class="sourceLine" id="cb2-5" title="5">                     <span class="dt">year_range =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2000</span>,<span class="dv">2009</span>),</a>
<a class="sourceLine" id="cb2-6" title="6">                     <span class="dt">lat_range =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">30</span>,<span class="dv">60</span>),</a>
<a class="sourceLine" id="cb2-7" title="7">                     <span class="dt">lon_range =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">30</span>))</a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co"># The object returned (slp) is a list.                     </span></a></code></pre></div>
<p>Now we need to convert our mslp data into S-mode data frame to compute the synoptic classification. To do this step, we use the <code>tidy_cuttime_nc</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">mslp_smode &lt;-<span class="st"> </span><span class="kw">tidy_cuttime_nc</span>(<span class="dt">datalist =</span> slp)</a></code></pre></div>
<p>Before computing the synoptic classification, you need to decide the number of components to retain. The scree test facilitates this decision (<code>pca_decision</code>). Nevertheless, the final decision about the number of PCs to retain is yours.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">info_pca_mslp &lt;-<span class="st"> </span><span class="kw"><a href="reference/pca_decision.html">pca_decision</a></span>(<span class="dt">smode_data =</span> mslp_smode<span class="op">$</span>smode_data)</a></code></pre></div>
<p>In a quick inspection, we have decided to retain 6 PC. We can spend more time analyzing the PCA results inspecting the <code>info_clas$summary</code>.</p>
<center><img src="img/scree_test.png" width="550"></center>
<p>The next step is computing the synoptic classification:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">synclas &lt;-<span class="st"> </span><span class="kw"><a href="reference/synoptclas.html">synoptclas</a></span>(<span class="dt">smode_data =</span> mslp_smode<span class="op">$</span>smode_data, </a>
<a class="sourceLine" id="cb5-2" title="2">                      <span class="dt">ncomp =</span>  <span class="dv">6</span>) </a>
<a class="sourceLine" id="cb5-3" title="3">synclas<span class="op">$</span>clas <span class="co"># classified days.</span></a></code></pre></div>
<p>If you do a short research exploration on the resulting object, you obtain some interesting stats about the classification procedure. For example,yearly or monthly temporal series can be obtained.</p>
<p>To represent the synoptic classification, we will use the raster_clas function to convert our classification into a raster object.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">synclas_raster &lt;-<span class="st"> </span><span class="kw">raster_clas</span>(<span class="dt">longitude =</span> slp<span class="op">$</span>lon,</a>
<a class="sourceLine" id="cb6-2" title="2">                              <span class="dt">latitude =</span> slp<span class="op">$</span>lat,</a>
<a class="sourceLine" id="cb6-3" title="3">                              <span class="dt">grouped_data =</span> synclas<span class="op">$</span>grouped_data,</a>
<a class="sourceLine" id="cb6-4" title="4">                              <span class="dt">option =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><strong>Important</strong>: be careful with option = 2. You can decide between 1 and 2. It is referred to lon and lat structure in the NetCDF file. So, if 1 is wrong, try 2.</p>
<p>This <code>RasterStack</code> can be plotted by many visualization packages. In this case we will use <code>ggplot2</code> (and other packages).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">"raster"</span>)) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"raster"</span>)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">"tidyverse"</span>)) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"tidyverse"</span>) <span class="co"># data manipulation and visualization</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">"metR"</span>)) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"metR"</span>)</a>
<a class="sourceLine" id="cb7-4" title="4"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">"rnaturalearth"</span>)) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"rnaturalearth"</span>) <span class="co">#basemap</span></a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(raster)</a>
<a class="sourceLine" id="cb7-7" title="7"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyr)</a>
<a class="sourceLine" id="cb7-8" title="8"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb7-9" title="9"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb7-10" title="10"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(metR)</a>
<a class="sourceLine" id="cb7-11" title="11"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rnaturalearth)</a>
<a class="sourceLine" id="cb7-12" title="12"></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co"># Manipulating the RasterStack to provide a ggplot visualization</span></a>
<a class="sourceLine" id="cb7-14" title="14"></a>
<a class="sourceLine" id="cb7-15" title="15">synclas_df &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(synclas_raster, <span class="dt">xy =</span> T)</a>
<a class="sourceLine" id="cb7-16" title="16"></a>
<a class="sourceLine" id="cb7-17" title="17">synclas_gather_df &lt;-<span class="st"> </span><span class="kw">gather</span>(<span class="dt">data =</span> synclas_df,</a>
<a class="sourceLine" id="cb7-18" title="18">                            <span class="dt">key =</span> <span class="st">"key"</span>,</a>
<a class="sourceLine" id="cb7-19" title="19">                            <span class="dt">value =</span> <span class="st">"value"</span>,</a>
<a class="sourceLine" id="cb7-20" title="20">                            CT1<span class="op">:</span>CT12) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="st">                     </span><span class="kw">mutate</span>(<span class="dt">value =</span> value<span class="op">/</span><span class="dv">100</span>) <span class="co">#conversion to hPa</span></a>
<a class="sourceLine" id="cb7-22" title="22">                            </a>
<a class="sourceLine" id="cb7-23" title="23">synclas_gather_df<span class="op">$</span>key &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(synclas_gather_df<span class="op">$</span>key, <span class="dt">levels =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"CT"</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>))</a></code></pre></div>
<p>After a brief manipulation, we can display the synoptic classification:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co"># Visualización</span></a>
<a class="sourceLine" id="cb8-2" title="2">map_bg &lt;-<span class="st"> </span><span class="kw">ne_countries</span>(<span class="dt">continent =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"europe"</span>, <span class="st">"africa"</span>),  <span class="dt">returnclass =</span> <span class="st">"sf"</span>)</a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4">syn_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">data =</span> synclas_gather_df, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">fill=</span>value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> map_bg, <span class="dt">fill=</span><span class="st">"transparent"</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="st">  </span><span class="kw">geom_contour2</span>(<span class="dt">data =</span> synclas_gather_df, <span class="kw">aes</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y,<span class="dt">z=</span>value), <span class="dt">binwidth =</span> <span class="dv">4</span>, <span class="dt">color =</span> <span class="st">"black"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="st">  </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colours =</span> colorRamps<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/colorRamps/man/matlab.like.html">matlab.like2</a></span>(<span class="dv">100</span>), <span class="dt">name =</span> <span class="st">"hPa"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="st">  </span><span class="kw">scale_colour_gradient</span>(<span class="dt">guide =</span> <span class="st">'none'</span>) <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key, <span class="dt">ncol =</span> <span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">9</span>,<span class="dv">29</span>), <span class="dt">expand =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">31</span>,<span class="dv">59</span>), <span class="dt">expand =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_blank</span>(), </a>
<a class="sourceLine" id="cb8-13" title="13">                     <span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb8-14" title="14">                     <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb8-15" title="15"></a>
<a class="sourceLine" id="cb8-16" title="16">syn_plot <span class="op">+</span><span class="st"> </span><span class="kw">geom_text_contour</span>(<span class="dt">data=</span> synclas_gather_df,<span class="kw">aes</span>(x,y,<span class="dt">z =</span> value), <span class="dt">stroke =</span> <span class="fl">0.15</span>,<span class="dt">binwidth =</span> <span class="dv">4</span>)</a></code></pre></div>
<center><img src="img/classification.png" width="800"></center>
<p>Now we would like to know how the precipitation is spatialy distributed over the Balearic Islands (Spain) for each weather type. To do it, we need to read our <code>precp_grid</code> data and reformat with <code>tidy_cuttime_nc</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(precp_grid) </a>
<a class="sourceLine" id="cb9-2" title="2">precp_grid_s &lt;-<span class="st"> </span><span class="kw">tidy_cuttime_nc</span>(<span class="dt">datalist =</span> precp_grid)</a></code></pre></div>
<p><strong>Important</strong>: Note that mslp data and precp_grid data must share the same time series (2000-01-01 to 2009-12-31). It is very important!</p>
<p>Now, we compute the mean precipitation by CT and convert to a raster object by means of the <code>raster_ct2env</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">raster_env &lt;-<span class="st"> </span><span class="kw">raster_ct2env</span>(precp_grid<span class="op">$</span>lon, </a>
<a class="sourceLine" id="cb10-2" title="2">                            precp_grid<span class="op">$</span>lat, </a>
<a class="sourceLine" id="cb10-3" title="3">                            synclas<span class="op">$</span>clas,</a>
<a class="sourceLine" id="cb10-4" title="4">                            <span class="dt">grid_data =</span> precp_grid_s<span class="op">$</span>smode_data,</a>
<a class="sourceLine" id="cb10-5" title="5">                            <span class="dt">option =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-6" title="6"></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="co"># Projecting to CRS WGS84                            </span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="kw">crs</span>(raster_env) &lt;-<span class="st"> "+proj=utm +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"</span></a>
<a class="sourceLine" id="cb10-9" title="9"></a>
<a class="sourceLine" id="cb10-10" title="10">raster_env &lt;-<span class="st"> </span><span class="kw">projectRaster</span>(raster_env, <span class="dt">crs =</span> <span class="kw">crs</span>(map_bg))</a></code></pre></div>
<p>Time to plot the <code>raster_env</code> object:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># Manipulation</span></a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3">raster_env_df &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(raster_env, <span class="dt">xy =</span> T)</a>
<a class="sourceLine" id="cb11-4" title="4">raster_env_gather_df &lt;-<span class="st"> </span><span class="kw">gather</span>(<span class="dt">data =</span> raster_env_df,</a>
<a class="sourceLine" id="cb11-5" title="5">                            <span class="dt">key =</span> <span class="st">"key"</span>,</a>
<a class="sourceLine" id="cb11-6" title="6">                            <span class="dt">value =</span> <span class="st">"value"</span>,</a>
<a class="sourceLine" id="cb11-7" title="7">                            CT1<span class="op">:</span>CT12) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">value =</span> value<span class="op">/</span><span class="dv">10</span>) <span class="co">#conversion to mm</span></a>
<a class="sourceLine" id="cb11-9" title="9"></a>
<a class="sourceLine" id="cb11-10" title="10">raster_env_gather_df<span class="op">$</span>key &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(raster_env_gather_df<span class="op">$</span>key, <span class="dt">levels=</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"CT"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>))</a>
<a class="sourceLine" id="cb11-11" title="11"></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="co"># Visualization</span></a>
<a class="sourceLine" id="cb11-13" title="13">map_bg &lt;-<span class="st"> </span><span class="kw">ne_countries</span>(<span class="dt">country =</span> <span class="st">"spain"</span>, <span class="dt">scale =</span> <span class="dv">10</span>, <span class="dt">returnclass =</span> <span class="st">"sf"</span>)</a>
<a class="sourceLine" id="cb11-14" title="14"></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">data=</span>raster_env_gather_df, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">fill=</span>value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> map_bg, <span class="dt">fill=</span><span class="st">"transparent"</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="st">  </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colours =</span> <span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(colorRamps<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/colorRamps/man/matlab.like.html">matlab.like2</a></span>(<span class="dv">100</span>)), </a>
<a class="sourceLine" id="cb11-19" title="19">  <span class="dt">name =</span> <span class="st">"rainfall (mm)"</span>,<span class="dt">na.value=</span><span class="st">"transparent"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-20" title="20"><span class="st">  </span><span class="kw">scale_colour_gradient</span>(<span class="dt">guide =</span> <span class="st">'none'</span>) <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key, <span class="dt">ncol =</span> <span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-21" title="21"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="fl">4.5</span>), <span class="dt">expand =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb11-22" title="22"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">38.5</span>,<span class="fl">40.25</span>), <span class="dt">expand =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-23" title="23"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_blank</span>(), </a>
<a class="sourceLine" id="cb11-24" title="24">                     <span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb11-25" title="25">                     <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<center><img src="img/precipitation.png" width="800"></center>
<p>Once we have showed how the precipitation is spatially distributed in the Balearic Islands, we can perform a categorical regionalisation to extract the main precipitation regions/regimes of this area. To do this, we use the <code>raster_pca</code> over the <code>raster_env</code> to get the main spatial patterns. In addition, if we work with larger or mountainous areas, we can use the <code>aggregate</code> and <code>focal</code> arguments inside the <code>raster_pca</code> function in order to get a more continuous regionalisation.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">pca_precp &lt;-<span class="st"> </span><span class="kw"><a href="reference/raster_pca.html">raster_pca</a></span>(raster_env)</a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co"># For a quick inspection:</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(pca_precp<span class="op">$</span>rasterPCA)</a></code></pre></div>
<p>Nevertheless, we would like to obtain a final map showing the precipitation regions/regimes of our study area. You can use a <code>for</code> loop to find the ideal number of regions. In this case, we have applied a regionalization with 4 centers (regions).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># Regionalization </span></a>
<a class="sourceLine" id="cb13-2" title="2"></a>
<a class="sourceLine" id="cb13-3" title="3">precp_region &lt;-<span class="st"> </span><span class="kw"><a href="reference/regionalization.html">regionalization</a></span>(pca_precp<span class="op">$</span>rasterPCA, </a>
<a class="sourceLine" id="cb13-4" title="4">                                <span class="dt">centers =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb13-5" title="5"></a>
<a class="sourceLine" id="cb13-6" title="6">precp_region_df &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(precp_region<span class="op">$</span>regionalization, </a>
<a class="sourceLine" id="cb13-7" title="7">                                 <span class="dt">xy =</span> T)</a>
<a class="sourceLine" id="cb13-8" title="8"></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="co"># Visualization</span></a>
<a class="sourceLine" id="cb13-10" title="10"></a>
<a class="sourceLine" id="cb13-11" title="11">labels &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Region 1"</span>,<span class="st">"Region 2"</span>,</a>
<a class="sourceLine" id="cb13-12" title="12">           <span class="st">"Region 3"</span>, <span class="st">"Region 4"</span>)</a>
<a class="sourceLine" id="cb13-13" title="13">colours &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"mediumseagreen"</span>,<span class="st">"darkgoldenrod1"</span>,</a>
<a class="sourceLine" id="cb13-14" title="14">              <span class="st">"khaki1"</span>, <span class="st">"dodgerblue3"</span>)</a>
<a class="sourceLine" id="cb13-15" title="15"></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-17" title="17"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">data=</span>precp_region_df, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y,<span class="dt">fill=</span>layer)) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-18" title="18"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> map_bg, <span class="dt">fill=</span><span class="st">"transparent"</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb13-19" title="19"><span class="st">  </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colours =</span> colours,</a>
<a class="sourceLine" id="cb13-20" title="20">                       <span class="dt">guide =</span> <span class="st">"legend"</span>, <span class="dt">breaks =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb13-21" title="21">                       <span class="dt">na.value =</span> <span class="kw">alpha</span>(<span class="st">"white"</span>, <span class="dt">alpha =</span> <span class="fl">0.0</span>),</a>
<a class="sourceLine" id="cb13-22" title="22">                       <span class="dt">labels =</span> labels, <span class="dt">name=</span> <span class="st">""</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb13-23" title="23"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="fl">4.5</span>), <span class="dt">expand =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb13-24" title="24"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">38.5</span>,<span class="fl">40.25</span>), <span class="dt">expand =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-25" title="25"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb13-26" title="26"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),<span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb13-27" title="27">        <span class="dt">legend.position =</span> <span class="st">"bottom"</span>, <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<center><img src="img/regionalization.png" width="500"></center>
</div>
</div>
<div id="citation" class="section level2">
<h2 class="hasAnchor">
<a href="#citation" class="anchor"></a>Citation</h2>
<p><strong><em>Lemus-Canovas, M., Lopez-Bustins, J.A., Martin-Vide, J., Royé, D.</em></strong>, 2019. <em>synoptReg: An R package for computing a synoptic climate classification and a spatial regionalization of environmental data</em>. Environmental Modelling &amp; Software, Vol. 118,114-119pp, ISSN 1364-8152, <a href="https://doi.org/10.1016/j.envsoft.2019.04.006" class="uri">https://doi.org/10.1016/j.envsoft.2019.04.006</a></p>
</div>
<div id="contact" class="section level2">
<h2 class="hasAnchor">
<a href="#contact" class="anchor"></a>Contact</h2>
<p>Feel free to contact me at: <a href="mailto:mlemus@ub.edu" class="email">mlemus@ub.edu</a></p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=synoptReg">https://​cloud.r-project.org/​package=synoptReg</a>
</li>
<li>Report a bug at <br><a href="https://github.com/lemuscanovas/synoptReg/issues">https://​github.com/​lemuscanovas/​synoptReg/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 3)</li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing synoptReg</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Marc Lemus-Canovas <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-0925-3827" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID"></a> </li>
<li>Dominic Roye) <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-5516-6396" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID"></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=synoptReg"><img src="https://www.r-pkg.org/badges/version/synoptReg" alt="CRAN status"></a></li>
<li><a href="http://cran.rstudio.com/web/packages/synoptReg/index.html"><img src="http://cranlogs.r-pkg.org/badges/grand-total/synoptReg"></a></li>
<li><a href="http://www.repostatus.org/#active"><img src="http://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active – The project has reached a stable, usable state and is being actively developed."></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Marc Lemus-Canovas, Dominic Roye).</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
