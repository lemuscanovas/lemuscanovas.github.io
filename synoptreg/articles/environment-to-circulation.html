<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Environment-To-Circulation • synoptReg</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Environment-To-Circulation">
<meta property="og:description" content="synoptReg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">synoptReg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/circulation-to-environment.html">Circulation-To-Environment</a>
    </li>
    <li>
      <a href="../articles/classification_metrics.html">Extracting metrics from the synoptic classification</a>
    </li>
    <li>
      <a href="../articles/environment-to-circulation.html">Environment-To-Circulation</a>
    </li>
    <li>
      <a href="../articles/Lamb.html">Objective Lamb classification</a>
    </li>
    <li>
      <a href="../articles/SOM.html">Self-Organizing Maps</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lemuscanovas/synoptReg/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="environment-to-circulation_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Environment-To-Circulation</h1>
                        <h4 class="author">Marc Lemus-Canovas</h4>
            
            <h4 class="date">2021-04-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lemuscanovas/synoptReg/blob/master/vignettes/environment-to-circulation.Rmd"><code>vignettes/environment-to-circulation.Rmd</code></a></small>
      <div class="hidden name"><code>environment-to-circulation.Rmd</code></div>

    </div>

    
    
<p>In this case we will develop a synoptic classification that goes from environment to circulation. A simple example would be to study the WT associated to daily rainfall equal or greater than 100 mm.</p>
<div id="introduction-to-the-t-mode-classification-method" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-to-the-t-mode-classification-method" class="anchor"></a>Introduction to the T-mode classification method</h1>
<p>The structure of the matrix in <code>T-mode</code> establishes that the variables are the days, and the observations are the grid points. In this case, the PCA establishes the linear relationships between each daily map of the atmospheric variable in order to extract the main WT. The PCA associates directly those days more similar to each other to group the WTs, so it is not necessary to use any clustering method. <code>synoptReg</code> allows to perform three variants of the <code>T-mode</code> based on:</p>
<ol style="list-style-type: decimal">
<li><p>Positive and negative (PN) correlations (loadings) of each of the days against each PC. Day 1 may be associated with PC X+ or PC X-, depending on whether the correlation is positive or negative. This last option, allows to obtain the double of classes of the selected components. If 4 PCs are selected, the final result can reach up to a maximum of 8 CTs.</p></li>
<li><p>Maximum positive correlations (MAX) of each day against each PC. Day 1 will be associated with the PC with a higher <strong>positive</strong> correlation;</p></li>
<li><p>Absolute correlations (ABS) of each day against each PC. Day 1 will be associated with the PC with a higher <strong>absolute</strong> correlation.</p></li>
</ol>
<p>See the follwing example:</p>
<table class="table">
<thead><tr class="header">
<th>time</th>
<th>PC1</th>
<th>PC2</th>
<th>PC3</th>
<th>PN</th>
<th>MAX</th>
<th>ABS</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>2000-01-01</td>
<td>0.7</td>
<td>0.3</td>
<td>-0.4</td>
<td>1+</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>2000-01-02</td>
<td>0.5</td>
<td>0.4</td>
<td>-0.6</td>
<td>3-</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="odd">
<td>2000-01-03</td>
<td>0.2</td>
<td>0.5</td>
<td>-0.7</td>
<td>3-</td>
<td>2</td>
<td>3</td>
</tr>
<tr class="even">
<td>2000-01-04</td>
<td>-0.3</td>
<td>0.5</td>
<td>-0.4</td>
<td>2+</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td>2000-01-05</td>
<td>-0.6</td>
<td>0.4</td>
<td>-0.1</td>
<td>1-</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>Note, that a VARIMAX rotation is applied to the retained PCs. See <a href="articles/circulation-to-environment.html">Circulation-To-Environment approach</a> vignette for more information about PC rotation.</p>
<p>It is recommended to review the references proposed in the section <a href="#method-references">Method references</a>.</p>
</div>
<div id="extracting-the-torrential-rainfall-events-100-mm24h" class="section level1">
<h1 class="hasAnchor">
<a href="#extracting-the-torrential-rainfall-events-100-mm24h" class="anchor"></a>Extracting the torrential rainfall events (&gt;= 100 mm/24h)</h1>
<p>In this example we will extract every day that has at least one point of grid with a precipitation &gt;= 100 mm in the Balearic Islands. This can easily be done with the <code><a href="https://dplyr.tidyverse.org/reference/dplyr-package.html">dplyr()</a></code> library from the <code>tidyverese</code> <a href="https://doi.org/10.21105/joss.01686">(Wickham et al., 2019)</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">synoptReg</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">pcp</span><span class="op">)</span>

<span class="va">torrential_dates</span> <span class="op">&lt;-</span> <span class="va">pcp</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">value</span> <span class="op">/</span><span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># converting to mm</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">value</span> <span class="op">&gt;=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The result is a vector of 83 dates that reflect those days with a precipitation &gt;= to 100 mm at any point of the Balearic Islands.</p>
</div>
<div id="synoptic-classification-procedure" class="section level1">
<h1 class="hasAnchor">
<a href="#synoptic-classification-procedure" class="anchor"></a>Synoptic classification procedure</h1>
<div id="reading-netcdf-data" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-netcdf-data" class="anchor"></a>Reading NetCDF data</h2>
<p>In order to compute the synoptic classification of these 83 events we need to read previously the amospheric data from the ERA-Interim dataset <a href="http://dx.doi.org/10.1002/qj.828">(Dee et al., 2011)</a>, stored in <code>NetCDF</code> files. To read these type of files, <code>synoptReg</code> does not have a specific function. In previous versions it did, but now there are more intuitive and simple alternatives for reading it. In this case, we will use the <code><a href="https://rdrr.io/pkg/metR/man/ReadNetCDF.html">ReadNetCDF()</a></code> function included in <a href="https://eliocamp.github.io/metR/index.html"><code>metR</code></a>. The variables we will read are: mean sea level pressure (mslp), geopotential height at 500 hPa (z500) and temperature at 850 hPa (t850). Thus, our classification will be made with <strong>3 atmospheric variables</strong> that will provide information from different layers of the troposphere (surface and height).</p>
<p>Note that reading with <code><a href="https://rdrr.io/pkg/metR/man/ReadNetCDF.html">ReadNetCDF()</a></code> does not return exactly the desired <code>data.frame</code> format. For this reason, a simple manipulation with <code><a href="https://dplyr.tidyverse.org/reference/dplyr-package.html">dplyr()</a></code> is required:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eliocamp/metR">metR</a></span><span class="op">)</span>
<span class="co"># listing NetCDF files stored in synoptReg:</span>
<span class="va">slp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"mslp_ei.nc"</span>, package <span class="op">=</span> <span class="st">"synoptReg"</span><span class="op">)</span>
<span class="va">z500_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"z500_ei.nc"</span>, package <span class="op">=</span> <span class="st">"synoptReg"</span><span class="op">)</span>
<span class="va">t850_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"t850_ei.nc"</span>, package <span class="op">=</span> <span class="st">"synoptReg"</span><span class="op">)</span>

<span class="co"># Reading the data stored in the NetCDFs files as tibbles. it can take a while.</span>
<span class="va">slp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metR/man/ReadNetCDF.html">ReadNetCDF</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">slp_file</span>,vars <span class="op">=</span> <span class="st">"msl"</span>,out <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"time"</span>,<span class="st">"lat"</span>,<span class="st">"lon"</span>,<span class="st">"value"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">lon</span>,<span class="va">lat</span>,<span class="va">time</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span>

<span class="va">z500</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metR/man/ReadNetCDF.html">ReadNetCDF</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">z500_file</span>,vars <span class="op">=</span> <span class="st">"z"</span>,out <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"time"</span>,<span class="st">"lat"</span>,<span class="st">"lon"</span>,<span class="st">"value"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">lon</span>,<span class="va">lat</span>,<span class="va">time</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span>
                                       
<span class="va">t850</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metR/man/ReadNetCDF.html">ReadNetCDF</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">t850_file</span>,vars <span class="op">=</span> <span class="st">"t"</span>,out <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"time"</span>,<span class="st">"lat"</span>,<span class="st">"lon"</span>,<span class="st">"value"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">lon</span>,<span class="va">lat</span>,<span class="va">time</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="filtering-and-grouping-the-atmospheric-variables-using-the-torrential-events" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering-and-grouping-the-atmospheric-variables-using-the-torrential-events" class="anchor"></a>Filtering and grouping the atmospheric variables using the torrential events</h2>
<p>Now, we can proceed to: 1) grouping the three atmospheric variables in one unique <code>tibble</code>; 2) Subset the atmospheric variables using the torrential rainfall dates. All this process can be computed by means of <code><a href="../reference/tidy_nc.html">tidy_nc()</a></code>. A list is required to group the atmospheric variables.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vars_torrential</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tidy_nc.html">tidy_nc</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">slp</span>,<span class="va">z500</span>,<span class="va">t850</span><span class="op">)</span>,
                       time_subset <span class="op">=</span> <span class="va">torrential_dates</span>,
                       name_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"slp"</span>,<span class="st">"z500"</span>,<span class="st">"t850"</span><span class="op">)</span><span class="op">)</span>
<span class="va">vars_torrential</span>
<span class="co">#&gt; # A tibble: 35,607 x 6</span>
<span class="co">#&gt;    var     lon   lat time         value anom_value</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;       &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 slp   -15      55 2000-09-04 101343.      25.3 </span>
<span class="co">#&gt;  2 slp   -12.5    55 2000-09-04 101353.     -30.0 </span>
<span class="co">#&gt;  3 slp   -10      55 2000-09-04 101447.       1.31</span>
<span class="co">#&gt;  4 slp    -7.5    55 2000-09-04 101753.     274.  </span>
<span class="co">#&gt;  5 slp    -5      55 2000-09-04 102044.     505.  </span>
<span class="co">#&gt;  6 slp    -2.5    55 2000-09-04 102200.     644.  </span>
<span class="co">#&gt;  7 slp     0      55 2000-09-04 102296.     713.  </span>
<span class="co">#&gt;  8 slp     2.5    55 2000-09-04 102248.     657.  </span>
<span class="co">#&gt;  9 slp     5      55 2000-09-04 102092.     496.  </span>
<span class="co">#&gt; 10 slp     7.5    55 2000-09-04 101949.     347.  </span>
<span class="co">#&gt; # ... with 35,597 more rows</span></code></pre></div>
<p>We already have the variables grouped and filtered. In addition, <code><a href="../reference/tidy_nc.html">tidy_nc()</a></code> computes the anomaly of the atmospheric variables using the monthly average of the whole study period before filtering the dates.</p>
</div>
<div id="selecting-the-number-of-pcs-and-synoptic-classification-performance" class="section level2">
<h2 class="hasAnchor">
<a href="#selecting-the-number-of-pcs-and-synoptic-classification-performance" class="anchor"></a>Selecting the number of PCs and Synoptic classification performance</h2>
<p>As in the case of the <a href="articles/circulation-to-environment.html">circulation-to-environment</a> approach, it is important to take the decision on the number of components retain in order to carry out the synoptic classification. To help in the decision making process, <code><a href="../reference/pca_decision.html">pca_decision()</a></code> returns a scree test, among other stats:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">info</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pca_decision.html">pca_decision</a></span><span class="op">(</span><span class="va">vars_torrential</span>,ncomp <span class="op">=</span> <span class="fl">30</span>,norm <span class="op">=</span> <span class="cn">T</span>,matrix_mode <span class="op">=</span> <span class="st">"T-mode"</span><span class="op">)</span>
<span class="va">info</span><span class="op">$</span><span class="va">screeplot</span></code></pre></div>
<p><img src="environment-to-circulation_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">info</span><span class="op">$</span><span class="va">summary</span>
<span class="co">#&gt;                       1         2         3          4          5          6</span>
<span class="co">#&gt; sdev          5.1185115 3.6034342 3.1823508 2.57912608 2.37691417 2.27236344</span>
<span class="co">#&gt; prop.variance 0.3156525 0.1564426 0.1220163 0.08014327 0.06806893 0.06221248</span>
<span class="co">#&gt; cum.variance  0.3156525 0.4720952 0.5941115 0.67425478 0.74232370 0.80453618</span>
<span class="co">#&gt;                        7          8          9         10         11         12</span>
<span class="co">#&gt; sdev          1.55600120 1.46252779 1.25624418 1.14552095 1.03678028 0.96519519</span>
<span class="co">#&gt; prop.variance 0.02917036 0.02577093 0.01901385 0.01580986 0.01295076 0.01122412</span>
<span class="co">#&gt; cum.variance  0.83370654 0.85947747 0.87849132 0.89430118 0.90725194 0.91847606</span>
<span class="co">#&gt;                        13          14          15          16          17</span>
<span class="co">#&gt; sdev          0.868246644 0.792538727 0.762162574 0.727480937 0.697695736</span>
<span class="co">#&gt; prop.variance 0.009082557 0.007567682 0.006998696 0.006376247 0.005864811</span>
<span class="co">#&gt; cum.variance  0.927558617 0.935126299 0.942124996 0.948501243 0.954366054</span>
<span class="co">#&gt;                        18          19          20          21          22</span>
<span class="co">#&gt; sdev          0.565083481 0.557921056 0.517389968 0.502554709 0.465367037</span>
<span class="co">#&gt; prop.variance 0.003847221 0.003750312 0.003225209 0.003042906 0.002609235</span>
<span class="co">#&gt; cum.variance  0.958213275 0.961963587 0.965188796 0.968231703 0.970840938</span>
<span class="co">#&gt;                        23          24          25         26          27</span>
<span class="co">#&gt; sdev          0.405150685 0.397725264 0.389126510 0.37425815 0.367115122</span>
<span class="co">#&gt; prop.variance 0.001977676 0.001905848 0.001824331 0.00168758 0.001623777</span>
<span class="co">#&gt; cum.variance  0.972818613 0.974724461 0.976548792 0.97823637 0.979860149</span>
<span class="co">#&gt;                        28          29         30</span>
<span class="co">#&gt; sdev          0.339549481 0.334820645 0.33009835</span>
<span class="co">#&gt; prop.variance 0.001389083 0.001350661 0.00131283</span>
<span class="co">#&gt; cum.variance  0.981249232 0.982599893 0.98391272</span></code></pre></div>
<p>By means of the <em>Scree plot</em>, it seems reasonable to retain 5 PCs. These 5 PCs explain the 82% of the variance. With this information, we can already perform our synoptic classification, specifying that the matrix mode will be <code>"T-mode"</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/synoptclas.html">synoptclas</a></span><span class="op">(</span><span class="va">vars_torrential</span>,ncomp <span class="op">=</span> <span class="fl">6</span>,norm <span class="op">=</span> <span class="cn">T</span>,matrix_mode <span class="op">=</span> <span class="st">"T-mode"</span><span class="op">)</span>
<span class="co">#&gt; Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.</span>
<span class="co">#&gt; Using compatibility `.name_repair`.</span>
<span class="va">cl</span> <span class="co"># list object containing the classification and the classified grid</span>
<span class="co">#&gt; $clas_abs</span>
<span class="co">#&gt; # A tibble: 83 x 2</span>
<span class="co">#&gt;    time          WT</span>
<span class="co">#&gt;    &lt;date&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2000-09-04     5</span>
<span class="co">#&gt;  2 2000-10-11     2</span>
<span class="co">#&gt;  3 2000-10-22     3</span>
<span class="co">#&gt;  4 2001-02-18     1</span>
<span class="co">#&gt;  5 2001-07-16     2</span>
<span class="co">#&gt;  6 2001-09-06     5</span>
<span class="co">#&gt;  7 2001-11-10     2</span>
<span class="co">#&gt;  8 2001-11-11     2</span>
<span class="co">#&gt;  9 2001-11-14     2</span>
<span class="co">#&gt; 10 2001-11-15     2</span>
<span class="co">#&gt; # ... with 73 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $clas_max</span>
<span class="co">#&gt; # A tibble: 83 x 2</span>
<span class="co">#&gt;    time          WT</span>
<span class="co">#&gt;    &lt;date&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2000-09-04     5</span>
<span class="co">#&gt;  2 2000-10-11     1</span>
<span class="co">#&gt;  3 2000-10-22     4</span>
<span class="co">#&gt;  4 2001-02-18     2</span>
<span class="co">#&gt;  5 2001-07-16     5</span>
<span class="co">#&gt;  6 2001-09-06     5</span>
<span class="co">#&gt;  7 2001-11-10     2</span>
<span class="co">#&gt;  8 2001-11-11     2</span>
<span class="co">#&gt;  9 2001-11-14     2</span>
<span class="co">#&gt; 10 2001-11-15     2</span>
<span class="co">#&gt; # ... with 73 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $clas_pn</span>
<span class="co">#&gt; # A tibble: 83 x 2</span>
<span class="co">#&gt;    time       WT   </span>
<span class="co">#&gt;    &lt;date&gt;     &lt;chr&gt;</span>
<span class="co">#&gt;  1 2000-09-04 5+   </span>
<span class="co">#&gt;  2 2000-10-11 2-   </span>
<span class="co">#&gt;  3 2000-10-22 3-   </span>
<span class="co">#&gt;  4 2001-02-18 1-   </span>
<span class="co">#&gt;  5 2001-07-16 2-   </span>
<span class="co">#&gt;  6 2001-09-06 5+   </span>
<span class="co">#&gt;  7 2001-11-10 2+   </span>
<span class="co">#&gt;  8 2001-11-11 2+   </span>
<span class="co">#&gt;  9 2001-11-14 2+   </span>
<span class="co">#&gt; 10 2001-11-15 2+   </span>
<span class="co">#&gt; # ... with 73 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $grid_clas_abs</span>
<span class="co">#&gt; # A tibble: 2,574 x 9</span>
<span class="co">#&gt;    var     lon   lat time          WT mean_WT_value mean_WT_anom_val~ pval_ttest</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;     &lt;dbl&gt;         &lt;dbl&gt;             &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 slp   -15      55 2000-09-04     5       101889.              774.   0.0212  </span>
<span class="co">#&gt;  2 slp   -12.5    55 2000-09-04     5       102011.              848.   0.00777 </span>
<span class="co">#&gt;  3 slp   -10      55 2000-09-04     5       102119.              897.   0.00211 </span>
<span class="co">#&gt;  4 slp    -7.5    55 2000-09-04     5       102178.              915.   0.000765</span>
<span class="co">#&gt;  5 slp    -5      55 2000-09-04     5       102205.              884.   0.000677</span>
<span class="co">#&gt;  6 slp    -2.5    55 2000-09-04     5       102176.              833.   0.00113 </span>
<span class="co">#&gt;  7 slp     0      55 2000-09-04     5       102170.              795.   0.00138 </span>
<span class="co">#&gt;  8 slp     2.5    55 2000-09-04     5       102144.              743.   0.00194 </span>
<span class="co">#&gt;  9 slp     5      55 2000-09-04     5       102099.              674.   0.00292 </span>
<span class="co">#&gt; 10 slp     7.5    55 2000-09-04     5       102034.              584.   0.00497 </span>
<span class="co">#&gt; # ... with 2,564 more rows, and 1 more variable: cv_WT_value &lt;dbl&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $grid_clas_max</span>
<span class="co">#&gt; # A tibble: 2,574 x 9</span>
<span class="co">#&gt;    var     lon   lat time          WT mean_WT_value mean_WT_anom_val~ pval_ttest</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;     &lt;dbl&gt;         &lt;dbl&gt;             &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 slp   -15      55 2000-09-04     5       102091.              910.   0.00239 </span>
<span class="co">#&gt;  2 slp   -12.5    55 2000-09-04     5       102140.              910.   0.000816</span>
<span class="co">#&gt;  3 slp   -10      55 2000-09-04     5       102155.              871.   0.000382</span>
<span class="co">#&gt;  4 slp    -7.5    55 2000-09-04     5       102132.              816.   0.000185</span>
<span class="co">#&gt;  5 slp    -5      55 2000-09-04     5       102102.              728.   0.000177</span>
<span class="co">#&gt;  6 slp    -2.5    55 2000-09-04     5       102056.              661.   0.000298</span>
<span class="co">#&gt;  7 slp     0      55 2000-09-04     5       102030.              600.   0.000738</span>
<span class="co">#&gt;  8 slp     2.5    55 2000-09-04     5       101982.              530.   0.00277 </span>
<span class="co">#&gt;  9 slp     5      55 2000-09-04     5       101921.              451.   0.0109  </span>
<span class="co">#&gt; 10 slp     7.5    55 2000-09-04     5       101840.              354.   0.0482  </span>
<span class="co">#&gt; # ... with 2,564 more rows, and 1 more variable: cv_WT_value &lt;dbl&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $grid_clas_pn</span>
<span class="co">#&gt; # A tibble: 5,148 x 8</span>
<span class="co">#&gt;    var     lon   lat time       WT    mean_WT_value mean_WT_anom_va~ cv_WT_value</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;         &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1 slp   -15      55 2000-09-04 5+          102523.            1271.       0.601</span>
<span class="co">#&gt;  2 slp   -12.5    55 2000-09-04 5+          102497.            1197.       0.620</span>
<span class="co">#&gt;  3 slp   -10      55 2000-09-04 5+          102449.            1098.       0.646</span>
<span class="co">#&gt;  4 slp    -7.5    55 2000-09-04 5+          102387.            1013.       0.607</span>
<span class="co">#&gt;  5 slp    -5      55 2000-09-04 5+          102322.             892.       0.616</span>
<span class="co">#&gt;  6 slp    -2.5    55 2000-09-04 5+          102230.             784.       0.636</span>
<span class="co">#&gt;  7 slp     0      55 2000-09-04 5+          102158.             676.       0.706</span>
<span class="co">#&gt;  8 slp     2.5    55 2000-09-04 5+          102047.             550.       0.757</span>
<span class="co">#&gt;  9 slp     5      55 2000-09-04 5+          101921.             413.       0.757</span>
<span class="co">#&gt; 10 slp     7.5    55 2000-09-04 5+          101788.             274.       0.725</span>
<span class="co">#&gt; # ... with 5,138 more rows</span></code></pre></div>
<p>The object returned by <code>synoptclas</code> differs relatively from the object returned when we apply a classification in <code>"S-mode"</code>. This time, the output is a list with 4 objects: 2 objects are <code>tibbles</code> with the variables <code>time</code> and <code>WT</code>. The difference between the two objects lies in the grouping method applied to achieve the WTs. In <code>clas_abs</code> the association is done with the absolute correlations;In <code>clas_max</code> the association is done with the positive correlations; finally, in <code>clas_pn</code> the extreme positive and negative values are used to get the final groups. The three remaining objects are the grids classified with each of these methods. In this case, we will work with the PN approach. Let’s see the results:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ropenscilabs/rnaturalearth">rnaturalearth</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eliocamp/metR">metR</a></span><span class="op">)</span>

<span class="va">borders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rnaturalearth/man/ne_countries.html">ne_countries</a></span><span class="op">(</span>continent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"europe"</span>,<span class="st">"africa"</span><span class="op">)</span>,
                                       returnclass <span class="op">=</span> <span class="st">"sf"</span>,scale <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/metR/man/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cl</span><span class="op">$</span><span class="va">grid_clas_pn</span>, <span class="va">var</span> <span class="op">==</span> <span class="st">"z500"</span><span class="op">)</span>, 
              mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">lon</span>,<span class="va">lat</span>,z <span class="op">=</span> <span class="va">mean_WT_anom_value</span><span class="op">/</span><span class="fl">9.8</span><span class="op">)</span>, <span class="co"># to m</span>
              binwidth <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">borders</span>, fill <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/metR/man/geom_contour2.html">geom_contour2</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cl</span><span class="op">$</span><span class="va">grid_clas_pn</span>,<span class="va">var</span> <span class="op">==</span> <span class="st">"slp"</span><span class="op">)</span>,
                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>,y<span class="op">=</span><span class="va">lat</span>,z<span class="op">=</span><span class="va">mean_WT_value</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>, 
                binwidth <span class="op">=</span> <span class="fl">4</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/metR/man/geom_text_contour.html">geom_text_contour</a></span><span class="op">(</span>data<span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cl</span><span class="op">$</span><span class="va">grid_clas_pn</span>, <span class="va">var</span> <span class="op">==</span> <span class="st">"slp"</span><span class="op">)</span>,
                    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>,y<span class="op">=</span><span class="va">lat</span>,z<span class="op">=</span><span class="va">mean_WT_value</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>, 
                    stroke <span class="op">=</span> <span class="fl">0.15</span>,binwidth <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/metR/man/geom_contour2.html">geom_contour2</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cl</span><span class="op">$</span><span class="va">grid_clas_pn</span>,<span class="va">var</span> <span class="op">==</span> <span class="st">"t850"</span><span class="op">)</span>, 
                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>,y<span class="op">=</span><span class="va">lat</span>,z<span class="op">=</span><span class="va">mean_WT_anom_value</span><span class="op">)</span>, 
                binwidth <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/metR/man/geom_text_contour.html">geom_text_contour</a></span><span class="op">(</span>data<span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cl</span><span class="op">$</span><span class="va">grid_clas_pn</span>, <span class="va">var</span> <span class="op">==</span> <span class="st">"t850"</span><span class="op">)</span>,
                    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>,y<span class="op">=</span><span class="va">lat</span>,z<span class="op">=</span><span class="va">mean_WT_anom_value</span><span class="op">)</span>, 
                    stroke <span class="op">=</span> <span class="fl">0.15</span>,binwidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html">guide_colourbar</a></span><span class="op">(</span>barwidth <span class="op">=</span> <span class="fl">9</span>, barheight <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">WT</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/metR/man/scale_divergent.html">scale_fill_divergent</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Z anomaly (m)"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>,<span class="fl">15</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>,<span class="fl">55</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, 
      panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
      strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
      axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<p><img src="environment-to-circulation_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
</div>
</div>
<div id="analysing-the-spatial-contribution-of-each-wt-to-torrential-rainfall-in-the-balearic-islands" class="section level1">
<h1 class="hasAnchor">
<a href="#analysing-the-spatial-contribution-of-each-wt-to-torrential-rainfall-in-the-balearic-islands" class="anchor"></a>Analysing the spatial contribution of each WT to torrential rainfall in the Balearic Islands</h1>
<p>We can then calculate the maximum precipitation associated with these CT/WT. To do this we will use the function <code><a href="../reference/ct2env.html">ct2env()</a></code> indicating in the argument <code>fun</code> the function <code>max</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">max_torrential_pcp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ct2env.html">ct2env</a></span><span class="op">(</span><span class="va">pcp</span>,clas <span class="op">=</span> <span class="va">cl</span><span class="op">$</span><span class="va">clas_pn</span>,fun <span class="op">=</span> <span class="va">max</span>,out <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">max_torrential_pcp</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span>,fill<span class="op">=</span><span class="va">calc</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="http://kwstat.github.io/pals/reference/niccoli.html">linearl</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span>, 
  name <span class="op">=</span> <span class="st">"rainfall (mm/day)"</span>,na.value<span class="op">=</span><span class="st">"transparent"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_colour_gradient</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">WT</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html">guide_colourbar</a></span><span class="op">(</span>barwidth <span class="op">=</span> <span class="fl">9</span>, barheight <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, 
                     axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                     axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                     legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<p><img src="environment-to-circulation_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>In addition, we can assess the spatial variability of this torrential events by creating the function of the coefficient of variation (cv) in the <code>fun</code> argument:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cv_torrential_pcp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ct2env.html">ct2env</a></span><span class="op">(</span><span class="va">pcp</span>,
                            clas <span class="op">=</span> <span class="va">cl</span><span class="op">$</span><span class="va">clas_pn</span>,
                            fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">}</span>,
                            out <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">cv_torrential_pcp</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span>,fill<span class="op">=</span><span class="va">calc</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="http://kwstat.github.io/pals/reference/continuous.html">jet</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, 
  name <span class="op">=</span> <span class="st">"coeff. var (%)"</span>,na.value<span class="op">=</span><span class="st">"transparent"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_colour_gradient</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">WT</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html">guide_colourbar</a></span><span class="op">(</span>barwidth <span class="op">=</span> <span class="fl">9</span>, barheight <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, 
                     axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                     axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                     legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<p><img src="environment-to-circulation_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</div>
<div id="method-references" class="section level1">
<h1 class="hasAnchor">
<a href="#method-references" class="anchor"></a>Method references</h1>
<p><strong>Synoptic classification method</strong>:</p>
<p>For absolute maximum correlation/loadings approach:</p>
<ul>
<li>Lopez-Bustins, J.A., Martin-Vide, J., Sanchez-Lorenzo, A., 2008. Iberia winter rainfall trends based upon changes in teleconnection and circulation patterns. Glob. Planet. Change. <a href="https://doi.org/10.1016/j.gloplacha.2007.09.002" class="uri">https://doi.org/10.1016/j.gloplacha.2007.09.002</a>
</li>
</ul>
<p>For maximum positive-negative loadings approach:</p>
<ul>
<li>Martin-Vide, J., Sanchez-Lorenzo, A., Lopez-Bustins, J.A., Cordobilla, M.J., Garcia-Manuel, A., Raso, J.M., 2008. Torrential rainfall in northeast of the Iberian Peninsula: synoptic patterns and WeMO influence. Adv. Sci. Res. 2, 99–105. <a href="https://doi.org/10.5194/asr-2-99-2008" class="uri">https://doi.org/10.5194/asr-2-99-2008</a>
</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Marc Lemus-Canovas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
