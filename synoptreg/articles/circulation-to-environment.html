<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="synoptReg">
<title>Circulation-To-Environment • synoptReg</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Circulation-To-Environment">
<meta property="og:description" content="synoptReg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">synoptReg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/circulation-to-environment.html">Circulation-To-Environment</a>
    <a class="dropdown-item" href="../articles/classification_metrics.html">Extracting metrics from the synoptic classification</a>
    <a class="dropdown-item" href="../articles/environment-to-circulation.html">Environment-To-Circulation</a>
    <a class="dropdown-item" href="../articles/Lamb.html">Objective Lamb classification</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lemuscanovas/synoptReg/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Circulation-To-Environment</h1>
                        <h4 data-toc-skip class="author">Marc
Lemus-Canovas</h4>
            
            <h4 data-toc-skip class="date">2023-11-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lemuscanovas/synoptReg/blob/HEAD/vignettes/circulation-to-environment.Rmd" class="external-link"><code>vignettes/circulation-to-environment.Rmd</code></a></small>
      <div class="d-none name"><code>circulation-to-environment.Rmd</code></div>
    </div>

    
    
<p>The <code>synoptReg</code> package contains two main methods to
perform a synoptic classification based on the matrix mode. One of them
is the <code>S-mode</code>.</p>
<div class="section level2">
<h2 id="introduction-to-the-s-mode-classification-method">Introduction to the S-mode classification method<a class="anchor" aria-label="anchor" href="#introduction-to-the-s-mode-classification-method"></a>
</h2>
<p>The S-mode classification is that in which the grid points (lon-lat)
are the variables and the observations (rows), the days. Thus, the
application of a PCA on this type of matrix establishes the linear
relationships between the time series of all the grid points. In this
sense, the scores obtained in this type of classification show the
degree of representativeness of each day for each of the principal
components (PCs). However, the scores do not allow us to directly obtain
the circulation types (also known as “weather types”), since the same
day can be represented by different PCs. For example, 2018/01/23 may
have a certain degree of representation in the PC1, PC3 and PC6. For
this reason, we need to use the scores (degree of representation) as
coordinates in the multivariate space to execute a clustering method
that ends up creating groups between those days that are most similar to
each other. In addition, the VARIMAX rotation is applied to the retained
PCs in order to redistribute their explained variance. The variance of
the PCs after being rotated will probably not follow a consecutive
order. For example, the PC1 does not have to be the one that accumulates
the highest explained variance. Note that this rotation is not applied
in the <code><a href="../reference/pca_decision.html">pca_decision()</a></code> function.</p>
<p>In the <code>synoptReg</code> package the clustering method
implemented is the one proposed by <a href="https://rmets.onlinelibrary.wiley.com/doi/abs/10.1002/joc.1103" class="external-link"><em>Esteban
et al. (2005)</em></a>, based on the extreme scores. <em>Esteban et
al.</em> suggest that the extreme scores (positive and negative) of each
PC (&gt;2 or &lt;-2) can be used as the multivariate coordinates of each
cluster center to apply the k-means algorithm. In this sense, when using
the positive and negative scores, the groups in each component are split
(if for each group these extreme scores are reached). So, if we retain 4
PCs, our final classification can reach up to 8 weather
types/circulation types.</p>
</div>
<div class="section level2">
<h2 id="synoptic-classification-procedure">Synoptic classification procedure<a class="anchor" aria-label="anchor" href="#synoptic-classification-procedure"></a>
</h2>
<p>In this example we will use the data previously downloaded with the
<code><a href="../reference/download_ncep.html">download_ncep()</a></code> function. Specifically, we will use the
<code>mslp</code> object already loaded into the package, referring to
the mean sea level pressure. The time period of the atmospheric
variables is from 2000-01-01 to 2010-12-31. A total of 11 years.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">synoptReg</span><span class="op">)</span></span>
<span><span class="co">#&gt; The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,</span></span>
<span><span class="co">#&gt; which was just loaded, were retired in October 2023.</span></span>
<span><span class="co">#&gt; Please refer to R-spatial evolution reports for details, especially</span></span>
<span><span class="co">#&gt; https://r-spatial.org/r/2023/05/15/evolution4.html.</span></span>
<span><span class="co">#&gt; It may be desirable to make the sf package available;</span></span>
<span><span class="co">#&gt; package maintainers should consider adding sf to Suggests:.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ****</span></span>
<span><span class="co">#&gt; Welcome to synoptReg! </span></span>
<span><span class="co">#&gt; Using synoptReg for research publication?  Please cite it!</span></span>
<span><span class="co">#&gt; Lemus-Canovas, M. et al. synoptReg: An R package for computing a synoptic climate classification and a spatial regionalization of environmental data. </span></span>
<span><span class="co">#&gt; Environmental Modelling &amp; Software 118, 114-119 (2019). DOI: https://doi.org/10.1016/j.envsoft.2019.04.006.</span></span>
<span><span class="co">#&gt; ****</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.4</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.4.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/" class="external-link">rnaturalearth</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Support for Spatial objects (`sp`) will be deprecated in {rnaturalearth} and will be removed in a future release of the package. Please use `sf` objects with {rnaturalearth}. For example: `ne_download(returnclass = 'sf')`</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eliocamp/metR" class="external-link">metR</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'metR'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following object is masked from 'package:purrr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     cross</span></span>
<span></span>
<span><span class="va">slp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"mslp_ei.nc"</span>, package <span class="op">=</span> <span class="st">"synoptReg"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">msl_ei</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_nc.html">read_nc</a></span><span class="op">(</span><span class="va">slp_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">msl_ei</span><span class="op">)</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 11, 13, 4018  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 2.5, 2.5  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -16.25, 16.25, 28.75, 56.25  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 </span></span>
<span><span class="co">#&gt; source      : mslp_ei.nc </span></span>
<span><span class="co">#&gt; varname     : msl (Mean sea level pressure) </span></span>
<span><span class="co">#&gt; names       : msl_1, msl_2, msl_3, msl_4, msl_5, msl_6, ... </span></span>
<span><span class="co">#&gt; unit        :    Pa,    Pa,    Pa,    Pa,    Pa,    Pa, ... </span></span>
<span><span class="co">#&gt; time (days) : 2000-01-01 to 2010-12-31</span></span></code></pre></div>
<p>The first step before executing the synoptic classification is to
pass the function tidy_nc(), since it will allow us to join the two
atmospheric variables to execute the classification later. It is also
possible to subset the time period and the geographical extension. In
addition, whether we specify an argument or not, this function computes
the anomaly of each atmospheric variable. Such anomaly is computed with
respect to the monthly average. If we subset the time period using the
time_subet argument, the anomaly will be computed from this last
period.</p>
<p>In any case, now we will only group our atmospheric variables. It is
mandatory to use a list for grouping variables.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">msl_ei_sr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_synoptReg.html">as_synoptReg</a></span><span class="op">(</span><span class="va">msl_ei</span><span class="op">)</span></span></code></pre></div>
<p>Once the two variables are joined in the same tibble, we can proceed
to explore our data set to decide the number of components to retain.
For such decision we will use the pca_decision() function. It is
important to specify a number of generous components since what we want
is to know which number of components explain most of the variance in
our data. Also, since we’re working with 2 variables that have different
units of measurement, it’s important to normalize/standardize such
variables.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">info</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pca_decision.html">pca_decision</a></span><span class="op">(</span><span class="va">msl_ei_sr</span>,ncomp <span class="op">=</span> <span class="fl">30</span>,norm <span class="op">=</span> <span class="cn">T</span>,matrix_mode <span class="op">=</span> <span class="st">"S-mode"</span><span class="op">)</span></span>
<span><span class="va">info</span><span class="op">$</span><span class="va">screeplot</span> <span class="co">#scree test</span></span></code></pre></div>
<p><img src="circulation-to-environment_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">info</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> <span class="co"># first 10 PCs</span></span>
<span><span class="co">#&gt;                       1         2         3          4          5          6</span></span>
<span><span class="co">#&gt; sdev          8.2273640 5.7411415 4.2465834 2.59031446 2.33961526 1.84155183</span></span>
<span><span class="co">#&gt; prop.variance 0.4734711 0.2305518 0.1261396 0.04693286 0.03828785 0.02372138</span></span>
<span><span class="co">#&gt; cum.variance  0.4734711 0.7040229 0.8301625 0.87709538 0.91538323 0.93910461</span></span>
<span><span class="co">#&gt;                        7          8           9          10</span></span>
<span><span class="co">#&gt; sdev          1.31226694 1.19991499 1.044715181 0.790432555</span></span>
<span><span class="co">#&gt; prop.variance 0.01204527 0.01007101 0.007634276 0.004370204</span></span>
<span><span class="co">#&gt; cum.variance  0.95114988 0.96122089 0.968855163 0.973225367</span></span></code></pre></div>
<p>After taking a look at the scree test, it seems reasonable to retain
4 PCs, which could allow up to 8 WT. These 4 PCs explain arround 88% of
the explained variance. Now, we can already compute the synoptic
classification:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/synoptclas.html">synoptclas</a></span><span class="op">(</span><span class="va">msl_ei_sr</span>,ncomp <span class="op">=</span> <span class="fl">4</span>,norm <span class="op">=</span> <span class="cn">T</span>,matrix_mode <span class="op">=</span> <span class="st">"S-mode"</span><span class="op">)</span></span>
<span><span class="va">cl</span></span>
<span><span class="co">#&gt; $clas</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,018 × 2</span></span></span>
<span><span class="co">#&gt;    time          WT</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2000-01-01     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2000-01-02     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2000-01-03     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2000-01-04     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2000-01-05     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2000-01-06     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2000-01-07     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2000-01-08     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2000-01-09     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2000-01-10     5</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,008 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $grid_clas</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,144 × 8</span></span></span>
<span><span class="co">#&gt;        x     y time       var   units    WT mean_WT_value cv_WT_value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> -<span style="color: #BB0000;">15</span>      55 2000-01-01 msl   Pa        1       <span style="text-decoration: underline;">101</span>017.       1.43 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> -<span style="color: #BB0000;">15</span>      55 2000-01-05 msl   Pa        4        <span style="text-decoration: underline;">99</span>066.       1.12 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> -<span style="color: #BB0000;">15</span>      55 2000-01-09 msl   Pa        5       <span style="text-decoration: underline;">100</span>630.       1.20 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> -<span style="color: #BB0000;">15</span>      55 2000-01-14 msl   Pa        3       <span style="text-decoration: underline;">102</span>032.       0.863</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> -<span style="color: #BB0000;">15</span>      55 2000-01-22 msl   Pa        7       <span style="text-decoration: underline;">100</span>975.       1.23 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> -<span style="color: #BB0000;">15</span>      55 2000-03-12 msl   Pa        8       <span style="text-decoration: underline;">101</span>281.       1.02 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> -<span style="color: #BB0000;">15</span>      55 2000-03-21 msl   Pa        6       <span style="text-decoration: underline;">101</span>362.       1.13 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> -<span style="color: #BB0000;">15</span>      55 2000-03-28 msl   Pa        2       <span style="text-decoration: underline;">101</span>150.       1.09 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> -<span style="color: #BB0000;">12.5</span>    55 2000-01-01 msl   Pa        1       <span style="text-decoration: underline;">101</span>131.       1.40 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> -<span style="color: #BB0000;">12.5</span>    55 2000-01-05 msl   Pa        4        <span style="text-decoration: underline;">99</span>083.       1.08 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,134 more rows</span></span></span></code></pre></div>
<p>The object returned by synoptclas is a list that contains a tibble
with each date and its corresponding WT, and another tibble that is a
grid with the average value of the atmospheric variables for each CT.
With this last result we can create a visualization of these synoptic
patterns:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">borders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>continent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"europe"</span>,<span class="st">"africa"</span><span class="op">)</span>,</span>
<span>                                       returnclass <span class="op">=</span> <span class="st">"sf"</span>,</span>
<span>                        scale <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/metR/man/geom_contour_fill.html" class="external-link">geom_contour_fill</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cl</span><span class="op">$</span><span class="va">grid_clas</span>, <span class="va">var</span> <span class="op">==</span> <span class="st">"msl"</span><span class="op">)</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,z <span class="op">=</span> <span class="va">mean_WT_value</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>              binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">borders</span>, fill <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/metR/man/geom_contour2.html" class="external-link">geom_contour2</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cl</span><span class="op">$</span><span class="va">grid_clas</span>,<span class="va">var</span> <span class="op">==</span> <span class="st">"msl"</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span>,z<span class="op">=</span><span class="va">mean_WT_value</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>                  binwidth <span class="op">=</span> <span class="fl">4</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/metR/man/geom_text_contour.html" class="external-link">geom_text_contour</a></span><span class="op">(</span>data<span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cl</span><span class="op">$</span><span class="va">grid_clas</span>, <span class="va">var</span> <span class="op">==</span> <span class="st">"msl"</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span>,z<span class="op">=</span><span class="va">mean_WT_value</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>, </span>
<span>                      stroke <span class="op">=</span> <span class="fl">0.15</span>,binwidth <span class="op">=</span> <span class="fl">4</span>,skip <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colourbar</a></span><span class="op">(</span>barwidth <span class="op">=</span> <span class="fl">9</span>, barheight <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">WT</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/continuous.html" class="external-link">jet</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"MSLP (hPa)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>,<span class="fl">15</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>,<span class="fl">55</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>      panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>      strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="circulation-to-environment_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="from-circulation-types-to-environment">From circulation types to environment<a class="anchor" aria-label="anchor" href="#from-circulation-types-to-environment"></a>
</h2>
<p>synoptReg has a function called ct2env() that allows to estalblish
the link between the synoptic classification created previously and its
link with any environmental variable. In this case, the example uses
daily precipitation data from the Balearic Islands (Spain) at a
resolution of 5x5 km.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pcp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"pcp_spread.nc"</span>, package <span class="op">=</span> <span class="st">"synoptReg"</span><span class="op">)</span></span>
<span><span class="va">pcp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_nc.html">read_nc</a></span><span class="op">(</span><span class="va">pcp_file</span><span class="op">)</span></span></code></pre></div>
<p>As you can observe, the structure of the tibble is always the same
(variables: lon, lat, time, value) and has to be respected so that all
the functions of the package work correctly. How do we calculate the
interaction of WTs with precipitation?</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct2pcp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ct2env.html">ct2env</a></span><span class="op">(</span><span class="va">pcp</span>,clas <span class="op">=</span> <span class="va">cl</span><span class="op">$</span><span class="va">clas</span>,fun <span class="op">=</span> <span class="va">mean</span>,out <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span></span>
<span><span class="va">ct2pcp</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,688 × 5</span></span></span>
<span><span class="co">#&gt;          x       y WT       tp units</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1<span style="text-decoration: underline;">105</span>672 4<span style="text-decoration: underline;">458</span>822 1     0.424 mm   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1<span style="text-decoration: underline;">105</span>672 4<span style="text-decoration: underline;">458</span>822 2     3.53  mm   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1<span style="text-decoration: underline;">105</span>672 4<span style="text-decoration: underline;">458</span>822 3     1.53  mm   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1<span style="text-decoration: underline;">105</span>672 4<span style="text-decoration: underline;">458</span>822 4     1.15  mm   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1<span style="text-decoration: underline;">105</span>672 4<span style="text-decoration: underline;">458</span>822 5     1.93  mm   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1<span style="text-decoration: underline;">105</span>672 4<span style="text-decoration: underline;">458</span>822 6     1.42  mm   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1<span style="text-decoration: underline;">105</span>672 4<span style="text-decoration: underline;">458</span>822 7     1.21  mm   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1<span style="text-decoration: underline;">105</span>672 4<span style="text-decoration: underline;">458</span>822 8     1.62  mm   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1<span style="text-decoration: underline;">085</span>672 4<span style="text-decoration: underline;">453</span>822 1     0.420 mm   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1<span style="text-decoration: underline;">085</span>672 4<span style="text-decoration: underline;">453</span>822 2     3.64  mm   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,678 more rows</span></span></span></code></pre></div>
<p>To visualize the result:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">ct2pcp</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>,color<span class="op">=</span><span class="va">tp</span><span class="op">)</span>, size <span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="co"># original was mm*10</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/niccoli.html" class="external-link">linearl</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span>,</span>
<span>                        trans <span class="op">=</span> <span class="st">"sqrt"</span>, </span>
<span>                        name <span class="op">=</span> <span class="st">"rainfall (mm)"</span>,</span>
<span>                        na.value<span class="op">=</span><span class="st">"transparent"</span>,guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>barheight <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">WT</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colourbar</a></span><span class="op">(</span>barwidth <span class="op">=</span> <span class="fl">9</span>, barheight <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>      panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>      strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="circulation-to-environment_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="creating-categorized-regions--the-last-step-">Creating categorized regions. The last step.<a class="anchor" aria-label="anchor" href="#creating-categorized-regions--the-last-step-"></a>
</h2>
<p>Finally, it may be interesting to classify our environmental
variables into different regions. Each one of these regions will have
different characteristics based on the relation with the precipitation
linked to each WT. To carry out such a categorization process, it is
necessary that our object ct2pcp is in SpatRaster format:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct2pcp_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ct2env.html">ct2env</a></span><span class="op">(</span><span class="va">pcp</span>,clas <span class="op">=</span> <span class="va">cl</span><span class="op">$</span><span class="va">clas</span>,fun <span class="op">=</span> <span class="va">mean</span>,out <span class="op">=</span> <span class="st">"SpatRaster"</span><span class="op">)</span></span>
<span><span class="va">ct2pcp_r</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 35, 53, 8  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 5000, 5000  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 863172, 1128172, 4286322, 4461322  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=utm +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varname     : tp </span></span>
<span><span class="co">#&gt; names       :         1,        2,        3,         4,         5,        6, ... </span></span>
<span><span class="co">#&gt; min values  : 0.1599424, 1.656782, 1.129224, 0.4895089, 0.6118959, 1.235447, ... </span></span>
<span><span class="co">#&gt; max values  : 1.3025937, 8.523975, 3.312900, 2.5515625, 4.5516729, 3.861095, ... </span></span>
<span><span class="co">#&gt; unit        :        mm,       mm,       mm,        mm,        mm,       mm, ...</span></span></code></pre></div>
<p>Now it is a matter of extracting the main spatial patterns of
precipitation linked to WTs.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Regionalization</span></span>
<span><span class="va">ct2pcp_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regionalization.html">regionalization</a></span><span class="op">(</span><span class="va">ct2pcp_r</span>,centers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">precp_region_df</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">ct2pcp_reg</span><span class="op">$</span><span class="va">cluster_rast</span>, </span>
<span>                                 xy <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># Visualization:</span></span>
<span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Region 1"</span>,<span class="st">"Region 2"</span>,</span>
<span>           <span class="st">"Region 3"</span>, <span class="st">"Region 4"</span><span class="op">)</span></span>
<span><span class="va">colours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mediumseagreen"</span>,<span class="st">"darkgoldenrod1"</span>,</span>
<span>              <span class="st">"khaki1"</span>, <span class="st">"dodgerblue3"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">precp_region_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>,fill<span class="op">=</span><span class="va">lyr1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="va">colours</span>,</span>
<span>                       guide <span class="op">=</span> <span class="st">"legend"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span>,</span>
<span>                       na.value <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.0</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="va">labels</span>, name<span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"bottom"</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="circulation-to-environment_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marc Lemus-Canovas.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
